# Backend часть приложения чата

Это backend часть приложения чата, построенная с использованием NestJS и TypeScript.

## Возможности

- RESTful API эндпоинты
- Обмен сообщениями в реальном времени через WebSocket
- JWT аутентификация
- Интеграция с SQL Server через TypeORM
- Валидация входных данных и обработка ошибок
- Миграции базы данных

## Структура проекта

```
backend/
├── src/
│   ├── auth/              # Модуль аутентификации
│   ├── chat/              # Модуль чата
│   ├── users/             # Модуль пользователей
│   ├── config/            # Конфигурационные файлы
│   ├── migrations/        # Миграции базы данных
│   ├── app.module.ts      # Главный модуль приложения
│   └── main.ts           # Точка входа в приложение
├── test/                  # Тестовые файлы
└── package.json          # Зависимости и скрипты проекта
```

## Основные модули

### Модуль аутентификации
- JWT-based аутентификация
- Регистрация и вход пользователей
- Хеширование паролей с bcrypt
- Защита маршрутов

### Модуль чата
- Обработка сообщений в реальном времени
- Сохранение сообщений
- Обработка WebSocket событий
- Получение истории чата

### Модуль пользователей
- Управление пользователями
- Операции с профилями пользователей
- Поиск и список пользователей

## Переменные окружения

Создайте файл `.env` в директории backend:

```env
DB_HOST=localhost
DB_PORT=1700
DB_USERNAME=sa
DB_PASSWORD=your_password
DB_DATABASE=chat_db
JWT_SECRET=your_jwt_secret
```

## Доступные скрипты

```bash
# Установка зависимостей
npm install

# Запуск сервера разработки
npm run start:dev

# Сборка приложения
npm run build

# Запуск продакшен сервера
npm run start:prod

# Запуск миграций
npm run migration:run

# Создание новой миграции
npm run migration:generate

# Откат последней миграции
npm run migration:revert
```

## Зависимости

### Основные зависимости
- `@nestjs/common`: ^10.0.0
- `@nestjs/core`: ^10.0.0
- `@nestjs/platform-express`: ^10.0.0
- `@nestjs/websockets`: ^10.0.0
- `@nestjs/typeorm`: ^10.0.0
- `@nestjs/jwt`: ^10.1.0
- `@nestjs/passport`: ^10.0.0
- `typeorm`: ^0.3.17
- `mssql`: ^9.1.1
- `bcrypt`: ^5.1.0

### Зависимости разработки
- `@types/node`: ^20.3.1
- `typescript`: ^5.1.3
- `ts-node`: ^10.9.1

## API эндпоинты

### Аутентификация
- POST `/api/auth/register` - Регистрация нового пользователя
- POST `/api/auth/login` - Вход пользователя

### Пользователи
- GET `/api/users` - Получение всех пользователей
- GET `/api/users/me` - Получение профиля текущего пользователя

### Чат
- GET `/api/chat/messages` - Получение сообщений чата
- POST `/api/chat/messages` - Отправка нового сообщения

## WebSocket события

### Серверные события (Отправка)
- `newMessage` - Уведомление о новом сообщении
- `userStatus` - Обновления статуса пользователя

### Клиентские события (Прием)
- `sendMessage` - Получение нового сообщения от клиента
- `connection` - Подключение клиента
- `disconnect` - Отключение клиента

## База данных

### Сущности
- Пользователь (User)
  - id
  - email
  - password
  - username
  - sentMessages
  - receivedMessages

- Сообщение (Message)
  - id
  - text
  - sender
  - receiver
  - timestamp

### Миграции
Проект использует миграции TypeORM для управления схемой базы данных. Основные файлы миграций:

- `1703940000000-CreateMessagesTable.ts`

## Безопасность

### Аутентификация
- JWT токены для API аутентификации
- Аутентификация WebSocket соединений
- Хеширование паролей с bcrypt

### Авторизация
- Защита маршрутов
- Защита WebSocket
- Проверка прав пользователей

### Валидация данных
- Валидация DTO с использованием class-validator
- Санитизация входных данных
- Middleware обработки ошибок

## Обработка ошибок

Приложение включает комплексную обработку ошибок для:

- Операций с базой данных
- Ошибок аутентификации
- Валидации входных данных
- WebSocket соединений
- Бизнес-логики

## Тестирование

Приложение поддерживает различные типы тестов:

- Модульные тесты
- Интеграционные тесты
- E2E тесты

## Как внести свой вклад

1. Сделайте форк репозитория
2. Создайте ветку для вашей функциональности
3. Зафиксируйте изменения
4. Отправьте изменения в репозиторий
5. Создайте Pull Request 